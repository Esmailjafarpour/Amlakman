<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù¾Ù†Ù„ ÙÙˆÙ‚ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø§Ù…Ù„Ø§Ú© Ù†Ø§Ø¯Ø±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;400;700;900&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = { darkMode: "class" };
    </script>
    <style>
      body {
        font-family: "Vazirmatn", sans-serif;
        transition: 0.3s;
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .error-shake {
        animation: shake 0.5s;
        border: 2px solid #ef4444 !important;
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }
      .glass {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(12px);
      }
      .dark .glass {
        background: rgba(15, 23, 42, 0.8);
      }
      .swiper-container {
        display: flex;
        overflow-x: auto;
        scrollbar-width: none;
        scroll-snap-type: x mandatory;
      }
      .swiper-slide {
        flex-shrink: 0;
        width: 100%;
        scroll-snap-align: start;
        height: 280px;
      }
      .nav-active {
        color: #2563eb !important;
        transform: scale(1.1);
      }
      .error-text {
        animation: fadeIn 0.3s ease;
      }
      .border-red-500 {
        border-color: #ef4444 !important;
        background-color: #fef2f2 !important; /* ÛŒÚ© Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø®ÛŒÙ„ÛŒ Ù…Ù„Ø§ÛŒÙ… Ù‚Ø±Ù…Ø² */
      }
      .swiper-container {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
      }
      .swiper-slide {
        flex: 0 0 100%;
        scroll-snap-align: start;
      }
    </style>
  </head>
  <body
    class="pb-36 bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 text-right"
  >
    <div
      id="authPage"
      class="fixed inset-0 z-[600] bg-white dark:bg-slate-950 flex flex-col items-center justify-center p-8 overflow-y-auto"
    >
      <h1 class="text-6xl font-black text-blue-600 mb-8 italic">Ø§Ù…Ù„Ø§Ú© Ù…Ù†</h1>

      <div id="loginBox" class="w-full max-w-sm space-y-4 text-center">
        <input
          type="tel"
          id="authPhone"
          placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„"
          maxlength="11"
          class="w-full bg-slate-100 dark:bg-slate-900 py-5 px-6 rounded-3xl outline-none text-center text-xl font-bold border-2 border-transparent focus:border-blue-500"
        />
        <button
          onclick="processAuth()"
          class="w-full bg-blue-600 text-white py-5 rounded-3xl font-black shadow-xl"
        >
          ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„
        </button>
        <button
          onclick="toggleAuthMode(true)"
          class="text-blue-600 font-bold text-sm mt-4"
        >
          Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…Ø´Ø§ÙˆØ± Ø¬Ø¯ÛŒØ¯
        </button>
      </div>

      <div id="registerBox" class="hidden w-full max-w-sm space-y-4">
        <div class="text-center mb-4">
          <label class="cursor-pointer inline-block relative">
            <img
              id="regAvatarPreview"
              src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"
              class="w-24 h-24 rounded-full border-4 border-blue-500 object-cover"
            />
            <input
              type="file"
              id="regAvatar"
              class="hidden"
              onchange="previewRegAvatar(this)"
            />
          </label>
        </div>
        <input
          type="text"
          id="regName"
          placeholder="Ù†Ø§Ù…"
          class="w-full bg-slate-100 dark:bg-slate-900 p-4 rounded-2xl outline-none font-bold"
        />
        <input
          type="text"
          id="regFamily"
          placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ"
          class="w-full bg-slate-100 dark:bg-slate-900 p-4 rounded-2xl outline-none font-bold"
        />
        <input
          type="tel"
          id="regPhone"
          placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„"
          maxlength="11"
          class="w-full bg-slate-100 dark:bg-slate-900 p-4 rounded-2xl outline-none font-bold text-center"
        />
        <button
          onclick="handleRegister()"
          class="w-full bg-blue-600 text-white py-5 rounded-3xl font-black"
        >
          Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¹Ø¶ÙˆÛŒØª
        </button>
        <button
          onclick="toggleAuthMode(false)"
          class="w-full text-slate-400 font-bold text-sm"
        >
          Ø¨Ø§Ø²Ú¯Ø´Øª
        </button>
      </div>

      <div id="pendingBox" class="hidden text-center space-y-4">
        <div class="text-6xl">â³</div>
        <h2 class="font-black text-xl">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯ Ø§Ø¯Ù…ÛŒÙ†...</h2>
        <button onclick="location.reload()" class="text-blue-600 font-bold">
          ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„
        </button>
      </div>
    </div>

    <div id="mainApp" class="hidden">
      <header
        class="p-5 glass sticky top-0 z-50 border-b dark:border-slate-800 flex justify-between items-center flex-row-reverse"
      >
        <div class="flex items-center gap-2">
          <button
            onclick="toggleDarkMode()"
            class="p-2 rounded-xl bg-slate-100 dark:bg-slate-800"
          >
            ğŸŒ™
          </button>
          <button
            onclick="handleLogout()"
            class="bg-red-500/10 text-red-500 p-2 rounded-xl text-xs font-bold"
          >
            Ø®Ø±ÙˆØ¬
          </button>
        </div>
        <div class="flex items-center gap-3 flex-row-reverse">
          <div class="text-right">
            <p id="userNameDisplay" class="text-xs font-black"></p>
            <span
              id="adminBadge"
              class="hidden bg-blue-600 text-[8px] px-2 py-0.5 rounded-full text-white font-black uppercase"
              >Admin</span
            >
          </div>
          <img
            id="headerAvatar"
            src=""
            class="w-12 h-12 rounded-full border-2 border-blue-500 object-cover shadow-lg"
          />
        </div>
      </header>

      <main id="home" class="tab-content active px-5 py-8">
        <div id="propertyContainer" class="space-y-10"></div>
      </main>

      <main id="dashboard" class="tab-content p-6">
        <h2 class="font-black text-lg mb-6 text-blue-600">Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
        <div id="adminTools" class="hidden space-y-6 mb-8">
          <div
            class="bg-orange-50 dark:bg-orange-900/10 p-4 rounded-3xl border border-orange-200"
          >
            <h3 class="text-xs font-black mb-3">ğŸ”” ØªØ§ÛŒÛŒØ¯ Ù…Ø´Ø§ÙˆØ±ÛŒÙ†</h3>
            <div id="pendingList" class="space-y-2"></div>
          </div>
          <div id="activeConsultants" class="space-y-2"></div>
        </div>
        <div id="myVisitsLog" class="space-y-3"></div>
      </main>

      <main id="security" class="tab-content p-6">
        <h2 class="font-black text-lg mb-6">ğŸ”‘ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù…Ù†ÛŒØª Ú©Ù„ÛŒØ¯Ù‡Ø§</h2>

        <div class="mb-10">
          <h3
            class="text-xs font-black text-orange-500 mb-4 flex items-center gap-2"
          >
            <span
              class="w-2 h-2 bg-orange-500 rounded-full animate-pulse"
            ></span>
            Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø®Ø§Ø±Ø¬ Ø´Ø¯Ù‡ (Ø¯Ø± Ø¯Ø³Øª Ù…Ø´Ø§ÙˆØ±)
          </h3>
          <div id="securityKeyList" class="space-y-4"></div>
        </div>

        <hr class="border-slate-200 dark:border-slate-800 mb-10" />

        <div>
          <h3
            class="text-xs font-black text-green-500 mb-4 flex items-center gap-2"
          >
            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
            ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª (Ø§Ù…Ø±ÙˆØ²)
          </h3>
          <div id="returnedKeyList" class="space-y-4 opacity-80"></div>
        </div>
      </main>

      <main id="calendar" class="tab-content p-6">
        <h2 class="font-black text-lg mb-6">ğŸ“… ØªÙ‚ÙˆÛŒÙ… Ù†Ø´Ø³Øªâ€ŒÙ‡Ø§ Ùˆ Ù‚Ø±Ø§Ø±Ù‡Ø§</h2>
        <button
          onclick="openCalendarModal()"
          class="w-full bg-blue-600 text-white p-4 rounded-2xl font-black mb-6"
        >
          + Ø«Ø¨Øª Ø¬Ù„Ø³Ù‡ Ø¬Ø¯ÛŒØ¯
        </button>
        <div id="calendarList" class="space-y-4"></div>
      </main>

      <div
        id="propModal"
        class="fixed inset-0 z-[700] hidden bg-black/80 backdrop-blur-md flex items-center justify-center p-6"
      >
        <div
          class="bg-white dark:bg-slate-900 w-full max-w-sm rounded-[3rem] p-8 overflow-y-auto max-h-[90vh]"
        >
          <h3 id="modalTitle" class="text-xl font-black mb-6 text-blue-600">
            Ø«Ø¨Øª Ù…Ù„Ú© Ø¬Ø¯ÛŒØ¯
          </h3>
          <input type="hidden" id="editIndex" value="-1" />
          <div class="space-y-4">
            <input
              type="file"
              id="pImages"
              multiple
              class="hidden"
              onchange="handleImageUpload(this)"
            />
            <label
              for="pImages"
              id="modalImgLabel"
              class="w-full h-20 border-2 border-dashed rounded-2xl flex items-center justify-center text-slate-400"
              >ğŸ“¸ Ø¹Ú©Ø³â€ŒÙ‡Ø§</label
            >
            <div id="previewGallery" class="flex gap-2 overflow-x-auto"></div>
            <input
              type="text"
              id="pCode"
              placeholder="Ú©Ø¯ Ù…Ù„Ú©"
              class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl outline-none font-bold"
            />
            <input
              type="text"
              id="pTitle"
              placeholder="Ø¹Ù†ÙˆØ§Ù†"
              class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl outline-none font-bold"
            />
            <input
              type="text"
              id="pPrice"
              placeholder="Ù‚ÛŒÙ…Øª"
              class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl outline-none font-bold"
            />
            <select
              id="pStatus"
              class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl outline-none font-bold"
            >
              <option value="empty_key_office">ğŸ—ï¸ Ø®Ø§Ù„ÛŒ - Ú©Ù„ÛŒØ¯ Ø¯Ø± Ø¨Ù†Ú¯Ø§Ù‡</option>
              <option value="empty_key_owner">ğŸ  Ø®Ø§Ù„ÛŒ - Ú©Ù„ÛŒØ¯ Ø¯Ø³Øª Ù…Ø§Ù„Ú©</option>
              <option value="owner_occupied">ğŸ‘¤ Ù…Ø§Ù„Ú© Ø³Ø§Ú©Ù† Ø§Ø³Øª</option>
              <option value="tenant_occupied">ğŸ‘¥ Ù…Ø³ØªØ£Ø¬Ø± Ø³Ø§Ú©Ù† Ø§Ø³Øª</option>
            </select>
            <div class="flex gap-2">
              <button
                onclick="saveProperty()"
                class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black"
              >
                Ø°Ø®ÛŒØ±Ù‡
              </button>
              <button onclick="closePropModal()" class="w-full text-slate-400">
                Ø§Ù†ØµØ±Ø§Ù
              </button>
            </div>
          </div>
        </div>
      </div>

      <div
        id="visitModal"
        class="fixed inset-0 z-[700] hidden bg-black/80 backdrop-blur-md flex items-center justify-center p-6"
      >
        <div
          class="bg-white dark:bg-slate-900 w-full max-w-sm rounded-[3rem] p-8"
        >
          <h3 class="font-black text-lg mb-4 text-center">Ø¬Ø²Ø¦ÛŒØ§Øª Ø®Ø±ÙˆØ¬ Ú©Ù„ÛŒØ¯</h3>
          <div class="space-y-4">
            <select
              id="visitConsultantSelect"
              class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl font-bold"
            ></select>
            <input
              type="text"
              id="visitCustomerName"
              placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ"
              class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl font-bold"
            />
            <button
              onclick="confirmVisit()"
              class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black"
            >
              ØªØ§ÛŒÛŒØ¯
            </button>
            <button onclick="closeVisitModal()" class="w-full text-slate-400">
              Ø§Ù†ØµØ±Ø§Ù
            </button>
          </div>
        </div>
      </div>

      <div
        id="calModal"
        class="fixed inset-0 z-[700] hidden bg-black/80 backdrop-blur-md flex items-center justify-center p-6"
      >
        <div class="bg-white dark:bg-slate-900 w-full max-w-sm rounded-xl p-8">
          <h3 class="font-black text-lg mb-4">Ø«Ø¨Øª Ù‚Ø±Ø§Ø± Ø¬Ø¯ÛŒØ¯</h3>
          <div class="space-y-4">
            <input
              type="text"
              id="calTitle"
              placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø¬Ù„Ø³Ù‡"
              class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl font-bold"
            />
            <input
              type="date"
              id="calDate"
              class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl font-bold"
            />
            <select
              id="calType"
              class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl font-bold"
            >
              <option value="Ù†Ø´Ø³Øª">ğŸ’ Ù†Ø´Ø³Øª Ù‚Ø±Ø§Ø±Ø¯Ø§Ø¯</option>
              <option value="Ø¨Ø§Ø²Ø¯ÛŒØ¯">ğŸ  Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ø­Ø¶ÙˆØ±ÛŒ</option>
              <option value="Ú©Ø§Ø±Ø´Ù†Ø§Ø³ÛŒ">ğŸ“ Ú©Ø§Ø±Ø´Ù†Ø§Ø³ÛŒ Ù…Ù„Ú©</option>
            </select>
            <div class="flex gap-2">
              <button
                onclick="saveCalendar()"
                class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black"
              >
                Ø«Ø¨Øª Ø¯Ø± ØªÙ‚ÙˆÛŒÙ…
              </button>
              <button
                onclick="
                  document.getElementById('calModal').classList.add('hidden')
                "
                class="w-full text-slate-400"
              >
                Ø§Ù†ØµØ±Ø§Ù
              </button>
            </div>
          </div>
        </div>
      </div>

      <nav
        class="fixed bottom-2 left-6 right-6 glass h-20 rounded-[2.5rem] flex justify-around items-center px-4 z-50 border shadow-2xl dark:border-slate-800"
      >
        <button
          onclick="showTab('home', this)"
          class="nav-item nav-active flex flex-col items-center"
        >
          <span class="text-xl">ğŸ </span
          ><span class="text-[8px] font-black">ÙˆÛŒØªØ±ÛŒÙ†</span>
        </button>
        <button
          onclick="showTab('dashboard', this)"
          class="nav-item text-slate-400 flex flex-col items-center"
        >
          <span class="text-xl">ğŸ“Š</span
          ><span class="text-[8px] font-black">ØªÛŒÙ…</span>
        </button>
        <button
          onclick="handlePlusButtonClick()"
          class="bg-blue-600 text-white w-14 h-14 rounded-full flex items-center justify-center shadow-xl border-4 border-white dark:border-slate-950 text-2xl font-bold"
        >
          +
        </button>
        <button
          onclick="showTab('security', this)"
          class="nav-item text-slate-400 flex flex-col items-center"
        >
          <span class="text-xl">ğŸ”‘</span
          ><span class="text-[8px] font-black">Ø§Ù…Ù†ÛŒØª</span>
        </button>
        <button
          onclick="showTab('calendar', this)"
          class="nav-item text-slate-400 flex flex-col items-center"
        >
          <span class="text-xl">ğŸ“…</span
          ><span class="text-[8px] font-black">ØªÙ‚ÙˆÛŒÙ…</span>
        </button>
      </nav>
    </div>

    <script>
      let properties = JSON.parse(localStorage.getItem("nader_props")) || [];
      let visits = JSON.parse(localStorage.getItem("active_visits")) || {};
      let visitHistory =
        JSON.parse(localStorage.getItem("nader_visit_history")) || [];
      let calendarEvents =
        JSON.parse(localStorage.getItem("nader_calendar")) || [];
      let currentImgList = [];
      let consultants = JSON.parse(localStorage.getItem("nader_v4_db")) || [
        {
          phone: "09337301641",
          name: "Ù†Ø§Ø¯Ø±",
          family: "Ù…Ø¯ÛŒØ±ÛŒØª",
          avatar: "https://cdn-icons-png.flaticon.com/512/3135/3135715.png",
          status: "active",
          isAdmin: true,
        },
      ];
      let currentUser = null,
        activeCode = null;

      function showErrorModal() {
        const modal = document.getElementById("errorModal");
        const content = document.getElementById("errorModalContent");
        modal.classList.remove("hidden");
        setTimeout(() => {
          content.classList.remove("scale-90");
          content.classList.add("scale-100");
        }, 10);
      }

      function closeErrorModal() {
        const modal = document.getElementById("errorModal");
        const content = document.getElementById("errorModalContent");
        content.classList.add("scale-90");
        content.classList.remove("scale-100");
        setTimeout(() => {
          modal.classList.add("hidden");
          document.getElementById("authPhone").value = ""; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ù…Ø¬Ø¯Ø¯
          document.getElementById("authPhone").focus();
        }, 200);
      }

      // --- Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª ---
      function toggleAuthMode(isReg) {
        document.getElementById("loginBox").classList.toggle("hidden", isReg);
        document
          .getElementById("registerBox")
          .classList.toggle("hidden", !isReg);
      }
      function previewRegAvatar(i) {
        const r = new FileReader();
        r.onload = (e) =>
          (document.getElementById("regAvatarPreview").src = e.target.result);
        r.readAsDataURL(i.files[0]);
      }
      function handleRegister() {
        // Ú¯Ø±ÙØªÙ† ÙÛŒÙ„Ø¯Ù‡Ø§
        const n = document.getElementById("regName");
        const f = document.getElementById("regFamily");
        const p = document.getElementById("regPhone");

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø§Ø±ÙˆØ±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
        clearErrors();

        let hasError = false;

        // 1. Ø§Ø¹ØªØ¨Ø§Ø± Ø³Ù†Ø¬ÛŒ Ù†Ø§Ù…
        if (n.value.trim().length < 2) {
          showError(n, "Ù†Ø§Ù… Ù†Ø¨Ø§ÛŒØ¯ Ú©Ù…ØªØ± Ø§Ø² Û² Ø­Ø±Ù Ø¨Ø§Ø´Ø¯");
          hasError = true;
        }

        // 2. Ø§Ø¹ØªØ¨Ø§Ø± Ø³Ù†Ø¬ÛŒ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ
        if (f.value.trim().length < 2) {
          showError(f, "Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø±Ø§ Ú©Ø§Ù…Ù„ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
          hasError = true;
        }

        // 3. Ø§Ø¹ØªØ¨Ø§Ø± Ø³Ù†Ø¬ÛŒ Ø³Ø®Øªâ€ŒÚ¯ÛŒØ±Ø§Ù†Ù‡ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
        const phoneValue = p.value.trim();
        if (phoneValue.length === 0) {
          showError(p, "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª");
          hasError = true;
        } else if (!/^09[0-9]{9}$/.test(phoneValue)) {
          showError(p, "Ø´Ù…Ø§Ø±Ù‡ Ø¨Ø§ÛŒØ¯ Û±Û± Ø±Ù‚Ù… Ùˆ Ø¨Ø§ Û°Û¹ Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯");
          hasError = true;
        }

        // Ø§Ú¯Ø± Ø®Ø·Ø§ Ø¯Ø§Ø´ØªÛŒÙ…ØŒ Ù…ØªÙˆÙ‚Ù Ø´Ùˆ
        if (hasError) return;

        // --- Ø¯Ø± ØµÙˆØ±Øª Ù†Ø¨ÙˆØ¯ Ø®Ø·Ø§: Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ù†Ø§Ø¯Ø± ---
        const newConsultant = {
          phone: phoneValue,
          name: n.value.trim(),
          family: f.value.trim(),
          avatar: document.getElementById("regAvatarPreview").src,
          status: "pending",
          isAdmin: false,
        };

        consultants.push(newConsultant);
        saveDB();

        // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ø§Ù†ØªØ¸Ø§Ø±
        document.getElementById("registerBox").classList.add("hidden");
        document.getElementById("pendingBox").classList.remove("hidden");
      }

      // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ø§Ø±ÙˆØ± Ø¨Ø§ Ù„Ø±Ø²Ø´ Ùˆ Ù…ØªÙ†
      function showError(el, message) {
        el.classList.add("error-shake", "border-red-500"); // Ù„Ø±Ø²Ø´ Ùˆ Ø±Ù†Ú¯ Ù‚Ø±Ù…Ø²

        // Ø³Ø§Ø®ØªÙ† ÛŒØ§ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† ØªÚ¯ Ù…ØªÙ† Ø§Ø±ÙˆØ±
        let errorMsg = document.createElement("p");
        errorMsg.className =
          "error-text text-[10px] text-red-500 mt-1 mr-2 font-bold animate-fadeIn";
        errorMsg.innerText = "âš ï¸ " + message;

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ØªÙ† Ø§Ø±ÙˆØ± Ø²ÛŒØ± ÙÛŒÙ„Ø¯
        el.parentNode.insertBefore(errorMsg, el.nextSibling);

        // Ø¨Ø¹Ø¯ Ø§Ø² Ûµ Ø«Ø§Ù†ÛŒÙ‡ Ù„Ø±Ø²Ø´ Ø±Ø§ Ø¨Ø±Ø¯Ø§Ø± Ø§Ù…Ø§ Ø±Ù†Ú¯ Ù‚Ø±Ù…Ø² Ø¨Ù…Ø§Ù†Ø¯ ØªØ§ Ø§ØµÙ„Ø§Ø­ Ø´ÙˆØ¯
        setTimeout(() => el.classList.remove("error-shake"), 500);
      }

      // ØªØ§Ø¨Ø¹ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø§Ø±ÙˆØ±Ù‡Ø§
      function clearErrors() {
        document.querySelectorAll(".error-text").forEach((el) => el.remove());
        document
          .querySelectorAll("input")
          .forEach((el) =>
            el.classList.remove("border-red-500", "error-shake"),
          );
      }
      function processAuth() {
        const p = document.getElementById("authPhone").value;
        const u = consultants.find((c) => c.phone === p);
        if (!u) {
          const input = document.getElementById("authPhone");
          input.classList.add("error-shake", "border-red-500");
          setTimeout(() => input.classList.remove("error-shake"), 500);
          showErrorModal(); // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¢Ù„Ø±Øª
          return;
        }
        if (u.status === "pending")
          return (
            document.getElementById("loginBox").classList.add("hidden"),
            document.getElementById("pendingBox").classList.remove("hidden")
          );
        currentUser = u;
        launchApp();
      }
      function launchApp() {
        document.getElementById("authPage").classList.add("hidden");
        document.getElementById("mainApp").classList.remove("hidden");
        document.getElementById("headerAvatar").src = currentUser.avatar;
        document.getElementById("userNameDisplay").innerText = currentUser.name;
        if (currentUser.isAdmin) {
          document.getElementById("adminBadge").classList.remove("hidden");
          document.getElementById("adminTools").classList.remove("hidden");
        }
        updateUI();
      }

      // --- ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ ---
      function handlePlusButtonClick() {
        // Ø¨Ù‡ Ø¬Ø§ÛŒ alertØŒ Ù…ÙˆØ¯Ø§Ù„ Ø´ÛŒÚ© Ø¹Ø¯Ù… Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…
        if (!currentUser.isAdmin) {
          showAccessModal();
          return;
        }

        // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø¬Ø¯ÛŒØ¯
        window.editingIndex = -1;
        document.getElementById("modalTitle").innerText = "Ø«Ø¨Øª Ù…Ù„Ú© Ø¬Ø¯ÛŒØ¯";
        document.getElementById("pCode").value = "";
        document.getElementById("pTitle").value = "";
        document.getElementById("pPrice").value = "";

        // ÛŒØ§Ø¯Øª Ø¨Ø§Ø´Ø¯ Ø§Ú¯Ø± ÙÛŒÙ„Ø¯ ÙˆØ¶Ø¹ÛŒØª Ø³Ú©ÙˆÙ†Øª Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯ÛŒØŒ Ø§ÛŒÙ†Ø¬Ø§ Ø±ÛŒØ³Øª Ø´ÙˆØ¯
        if (document.getElementById("pStatus")) {
          document.getElementById("pStatus").value = "empty_key_office";
        }

        currentImgList = [];
        document.getElementById("previewGallery").innerHTML = "";

        document.getElementById("propModal").classList.remove("hidden");
      }

      let uploadedImages = []; // Ø¢Ø±Ø§ÛŒÙ‡ Ù…ÙˆÙ‚Øª Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯

      function handleImageUpload(input) {
        const gallery = document.getElementById("previewGallery");

        if (input.files) {
          Array.from(input.files).forEach((file) => {
            const reader = new FileReader();
            reader.onload = function (e) {
              const img = new Image();
              img.src = e.target.result;
              img.onload = function () {
                // --- Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª Ú©ÙˆÚ†Ú© Ú©Ø±Ø¯Ù† Ø¹Ú©Ø³ ---
                const canvas = document.createElement("canvas");
                const MAX_WIDTH = 800; // Ø­Ø¯Ø§Ú©Ø«Ø± Ø¹Ø±Ø¶ Ø¹Ú©Ø³
                let width = img.width;
                let height = img.height;

                if (width > MAX_WIDTH) {
                  height *= MAX_WIDTH / width;
                  width = MAX_WIDTH;
                }

                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, width, height);

                // ØªØ¨Ø¯ÛŒÙ„ Ø¹Ú©Ø³ Ø¨Ù‡ ÙØ±Ù…Øª Ú©Ù…â€ŒØ­Ø¬Ù… (JPEG Ø¨Ø§ Ú©ÛŒÙÛŒØª Û°.Û·)
                const compressedData = canvas.toDataURL("image/jpeg", 0.7);

                // Ø­Ø§Ù„Ø§ Ø¹Ú©Ø³ Ú©Ù…â€ŒØ­Ø¬Ù… Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                currentImgList.push(compressedData);

                // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´
                const div = document.createElement("div");
                div.className = "relative min-w-[80px] h-20 shadow-md";
                div.innerHTML = `
                        <img src="${compressedData}" class="w-full h-full object-cover rounded-xl border-2 border-blue-500">
                        <button onclick="removeImgFromList(this, '${compressedData}')" class="absolute -top-4 -right-4 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs shadow-lg">âœ•</button>
                    `;
                gallery.appendChild(div);
              };
            };
            reader.readAsDataURL(file);
          });
        }
      }

      // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø¹Ú©Ø³ Ø§Ø² Ù„ÛŒØ³Øª Ù¾ÛŒØ´ Ø§Ø² Ø°Ø®ÛŒØ±Ù‡
      function removeImgFromList(btn, data) {
        currentImgList = currentImgList.filter((img) => img !== data);
        btn.parentElement.remove();
      }

      function saveProperty() {
        const c = document.getElementById("pCode");
        const t = document.getElementById("pTitle");
        const imgLabel = document.getElementById("modalImgLabel");

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø§Ø±ÙˆØ±Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
        document
          .querySelectorAll(".error-text-prop")
          .forEach((e) => e.remove());
        const rawPrice = document
          .getElementById("pPrice")
          .value.replace(/,/g, "");
        let hasError = false;

        // Ø§Ø¹ØªØ¨Ø§Ø± Ø³Ù†Ø¬ÛŒ Ø¹Ú©Ø³
        if (currentImgList.length === 0) {
          showPropError(imgLabel, "Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø¹Ú©Ø³ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯");
          hasError = true;
        }
        // Ø§Ø¹ØªØ¨Ø§Ø± Ø³Ù†Ø¬ÛŒ Ú©Ø¯ Ùˆ Ø¹Ù†ÙˆØ§Ù†
        if (!c.value.trim()) {
          showPropError(c, "Ú©Ø¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª");
          hasError = true;
        }
        if (!t.value.trim()) {
          showPropError(t, "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª");
          hasError = true;
        }

        if (hasError) return;

        const propData = {
          code: c.value,
          title: t.value,
          price: rawPrice || "ØªÙˆØ§ÙÙ‚ÛŒ",
          status: document.getElementById("pStatus").value, // Ø®Ø· Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØª
          imgs: [...currentImgList],
        };

        // Ú†Ú© Ú©Ø±Ø¯Ù† Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ø¯Ø± Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´ Ù‡Ø³ØªÛŒÙ… ÛŒØ§ Ø«Ø¨Øª Ø¬Ø¯ÛŒØ¯
        if (window.editingIndex !== undefined && window.editingIndex !== -1) {
          properties[window.editingIndex] = propData;
          window.editingIndex = -1; // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† Ø¨Ø¹Ø¯ Ø§Ø² ÙˆÛŒØ±Ø§ÛŒØ´
        } else {
          properties.unshift(propData); // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø§ÙˆÙ„ Ù„ÛŒØ³Øª
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±
        localStorage.setItem("nader_props", JSON.stringify(properties));

        closePropModal();
        updateUI();

        currentImgList = [];
        document.getElementById("previewGallery").innerHTML = "";
      }

      // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ø±ÙˆØ± Ø¯Ø± Ù…ÙˆØ¯Ø§Ù„ Ù…Ù„Ú©
      function showPropError(el, msg) {
        el.classList.add("error-shake", "border-red-500");
        const err = document.createElement("div");
        err.className =
          "error-text-prop text-[10px] text-red-500 font-bold mt-1";
        err.innerText = "âš ï¸ " + msg;
        el.parentNode.insertBefore(err, el.nextSibling);
        setTimeout(() => el.classList.remove("error-shake"), 500);
      }
      let tempKeyCode = null; // Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Øª Ú©Ø¯ Ù…Ù„Ú©ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒÙ… Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†ÛŒÙ…

      function handleKeyAction(code) {
        if (visits[code]) {
          // Ø¨Ù‡ Ø¬Ø§ÛŒ confirmØŒ Ù…ÙˆØ¯Ø§Ù„ Ø±Ø§ Ø¨Ø§Ø² Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
          tempKeyCode = code;
          document.getElementById("returnModalText").innerText =
            `Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø´Øª Ú©Ù„ÛŒØ¯ ÙˆØ§Ø­Ø¯ ${code} Ø¨Ù‡ Ø¨Ù†Ú¯Ø§Ù‡ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ`;
          showReturnModal();
        } else {
          activeCode = code;
          document.getElementById("visitConsultantSelect").innerHTML =
            consultants
              .filter((c) => c.status === "active")
              .map((c) => `<option>${c.name} ${c.family}</option>`)
              .join("");
          document.getElementById("visitModal").classList.remove("hidden");
        }
      }

      // ØªØ§Ø¨Ø¹ Ù†Ù‡Ø§ÛŒÛŒ Ø³Ø§Ø²ÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª (ÙˆÙ‚ØªÛŒ Ø¯Ú©Ù…Ù‡ ØªØ£ÛŒÛŒØ¯ Ù…ÙˆØ¯Ø§Ù„ Ø²Ø¯Ù‡ Ø´ÙˆØ¯)
      function executeReturn() {
        if (!tempKeyCode) return;

        const activeVisit = visits[tempKeyCode];

        if (activeVisit) {
          // Ø§ÛŒØ¬Ø§Ø¯ Ø¢ÛŒØªÙ… ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙÙ‚Ø· Ø¯Ø± Ù„Ø­Ø¸Ù‡ Ø¨Ø±Ú¯Ø´Øª Ú©Ù„ÛŒØ¯
          const historyItem = {
            code: activeVisit.code,
            consultant: activeVisit.consultant,
            consultantPhone: activeVisit.consultantPhone,
            customer: activeVisit.customer,
            outTime: activeVisit.time,
            inTime: new Date().toLocaleTimeString("fa-IR", {
              hour: "2-digit",
              minute: "2-digit",
            }),
          };

          // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡
          visitHistory.unshift(historyItem);

          // Ø°Ø®ÛŒØ±Ù‡ Ù…Ø§Ù†Ø¯Ú¯Ø§Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±
          localStorage.setItem(
            "nader_visit_history",
            JSON.stringify(visitHistory),
          );
        }

        // Ø­Ø°Ù Ø§Ø² Ù„ÛŒØ³Øª Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²Ø¯ÛŒØ¯ (ÙØ¹Ø§Ù„)
        delete visits[tempKeyCode];

        closeReturnModal();
        updateUI(); // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¸Ø§Ù‡Ø± Ú©Ù‡ Ø­Ø§Ù„Ø§ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
        tempKeyCode = null;
      }

      // ØªÙˆØ§Ø¨Ø¹ Ø¨Ø§Ø² Ùˆ Ø¨Ø³ØªÙ‡ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
      function showReturnModal() {
        const modal = document.getElementById("confirmReturnModal");
        const content = document.getElementById("confirmReturnContent");
        modal.classList.remove("hidden");
        setTimeout(() => {
          content.classList.remove("scale-90");
          content.classList.add("scale-100");
        }, 10);
      }

      function closeReturnModal() {
        const modal = document.getElementById("confirmReturnModal");
        const content = document.getElementById("confirmReturnContent");
        content.classList.add("scale-90");
        content.classList.remove("scale-100");
        setTimeout(() => {
          modal.classList.add("hidden");
        }, 200);
      }
      function confirmVisit() {
        const cust = document.getElementById("visitCustomerName");
        if (!cust.value) return triggerError(cust);

        // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´Ø§ÙˆØ± Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
        const selectedConsultantName = document.getElementById(
          "visitConsultantSelect",
        ).value;
        const consultantData = consultants.find(
          (c) => `${c.name} ${c.family}` === selectedConsultantName,
        );

        const data = {
          code: activeCode,
          consultant: selectedConsultantName,
          consultantPhone: consultantData ? consultantData.phone : "", // Ø°Ø®ÛŒØ±Ù‡ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
          customer: cust.value,
          time: new Date().toLocaleTimeString("fa-IR", {
            hour: "2-digit",
            minute: "2-digit",
          }),
        };

        visits[activeCode] = data;
        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ù…Ø±ÙˆØ±Ú¯Ø±
        localStorage.setItem("active_visits", JSON.stringify(visits));

        closeVisitModal();
        updateUI();
      }

      // --- ØªÙ‚ÙˆÛŒÙ… ---
      function openCalendarModal() {
        document.getElementById("calModal").classList.remove("hidden");
      }
      function saveCalendar() {
        const t = document.getElementById("calTitle"),
          d = document.getElementById("calDate"),
          type = document.getElementById("calType");
        if (!t.value || !d.value) return (triggerError(t), triggerError(d));
        calendarEvents.unshift({
          title: t.value,
          date: d.value,
          type: type.value,
          creator: currentUser.name,
        });
        document.getElementById("calModal").classList.add("hidden");
        updateUI();
      }

      // --- Ø¢Ù¾Ø¯ÛŒØª Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ ---
      function updateUI() {
        // Û±. Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒØªØ±ÛŒÙ† Ø§Ù…Ù„Ø§Ú©
        const propertyContainer = document.getElementById("propertyContainer");
        if (propertyContainer) {
          propertyContainer.innerHTML = properties
            .map((p, idx) => {
              // ØªØ¹ÛŒÛŒÙ† ÙˆØ¶Ø¹ÛŒØª Ù…Ù„Ú©
              let statusBtn = "";

              if (p.status === "empty_key_office") {
                // Ø­Ø§Ù„Øª Ú©Ù„ÛŒØ¯ Ø¯Ø± Ø¯ÙØªØ±
                statusBtn = `
                  <button onclick="handleKeyAction('${p.code}')" class="w-full ${visits[p.code] ? "bg-orange-500" : "bg-slate-900 dark:bg-blue-600"} text-white py-4 rounded-2xl font-black text-xs">
                      ${visits[p.code] ? "âš ï¸ Ø¯Ø³Øª: " + visits[p.code].consultant : "ğŸ”“ Ø®Ø±ÙˆØ¬ Ú©Ù„ÛŒØ¯ ÙˆØ§Ø­Ø¯ " + p.code}
                  </button>`;
              } else {
                // Ø­Ø§Ù„Øª Ù…Ø§Ù„Ú© ÛŒØ§ Ù…Ø³ØªØ§Ø¬Ø± Ø³Ø§Ú©Ù†
                if (currentUser.isAdmin) {
                  statusBtn = `
                    <div class="w-full space-y-2">
                        <div class="w-full bg-slate-100 dark:bg-slate-800 text-slate-400 py-3 rounded-2xl font-black text-[10px] text-center border-2 border-dashed">
                            ${getStatusStyle(p.status).text}
                        </div>
                        <button onclick="openCoordinationModal('${p.code}')" class="w-full bg-orange-500 text-white py-4 rounded-2xl font-black text-xs shadow-lg active:scale-95 transition-transform">
                            ğŸ“ Ø«Ø¨Øª Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ùˆ Ø¨Ø§Ø²Ø¯ÛŒØ¯
                        </button>
                    </div>`;
                } else {
                  // Ø¨Ø±Ø§ÛŒ Ø¨Ù‚ÛŒÙ‡ Ù…Ø´Ø§ÙˆØ±ÛŒÙ† ÙÙ‚Ø· Ù…ØªÙ† ÙˆØ¶Ø¹ÛŒØª
                  statusBtn = `
                    <div class="w-full bg-slate-100 dark:bg-slate-800 text-slate-400 py-4 rounded-2xl font-black text-xs text-center border-2 border-dashed">
                        ${getStatusStyle(p.status).text}
                    </div>`;
                }
              }

              return `
                <div class="bg-white dark:bg-slate-900 rounded-[2.5rem] overflow-hidden shadow-lg border dark:border-slate-800 relative">
                    ${currentUser.isAdmin ? `<button onclick="prepareEdit(${idx})" class="absolute top-4 left-4 z-20 bg-white/90 dark:bg-slate-800/90 p-2 rounded-full shadow-lg border border-blue-500">âœï¸</button>` : ""}
                    <div class="relative group">
                        <div id="slider-${idx}" onscroll="updateDots(${idx})" class="swiper-container flex overflow-x-auto snap-x snap-mandatory scroll-smooth shadow-inner">
                            ${(p.imgs || []).map((img) => `<div class="swiper-slide min-w-full snap-start h-72"><img src="${img}" class="w-full h-full object-cover"></div>`).join("")}
                        </div>
                        <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-1.5 z-10">
                            ${(p.imgs || []).map((_, i) => `<div id="dot-${idx}-${i}" class="w-2 h-2 rounded-full bg-white/40 transition-all ${i === 0 ? "bg-white w-4" : ""}"></div>`).join("")}
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-4 text-right">
                            <h3 class="font-black text-lg">${p.title}</h3>
                            <div class="text-xs font-black text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 px-3 py-2 rounded-xl inline-block">
                                ${formatPrice(p.price)}
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2 mb-4 w-full">
                            ${statusBtn}
                        </div>
                    </div>
                </div>`;
            })
            .join("");
        }

        // Û². Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ù†Ú¯Ù‡Ø¨Ø§Ù†ÛŒ (ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡)
        const activeVisitsArray = Object.values(visits);
        const filteredActiveVisits = currentUser.isAdmin
          ? activeVisitsArray
          : activeVisitsArray.filter(
              (v) => v.consultantPhone === currentUser.phone,
            );

        const securityList = document.getElementById("securityKeyList");
        if (securityList) {
          securityList.innerHTML =
            filteredActiveVisits
              .map(
                (v) => `
                <div class="bg-orange-50 dark:bg-orange-900/20 p-4 rounded-2xl border-r-4 border-orange-500 flex justify-between items-center shadow-sm">
                    <div>
                        <p class="font-black text-sm text-orange-700 dark:text-orange-400">ÙˆØ§Ø­Ø¯ ${v.code}</p>
                        <p class="text-[10px] opacity-70">ğŸ‘¤ Ù…Ø´Ø§ÙˆØ±: ${v.consultant}</p>
                        ${currentUser.isAdmin ? `<a href="tel:${v.consultantPhone}" class="text-[10px] text-blue-600 font-bold decoration-dotted underline">ğŸ“ ${v.consultantPhone}</a>` : `<p class="text-[10px] opacity-50">ğŸ“± ${v.consultantPhone}</p>`}
                        <p class="text-[10px] opacity-50">ğŸ•’ Ø®Ø±ÙˆØ¬: ${v.time}</p>
                    </div>
                    <button onclick="handleKeyAction('${v.code}')" class="text-[10px] bg-white dark:bg-slate-800 px-3 py-2 rounded-xl shadow-md font-bold">ØªØ§ÛŒÛŒØ¯ Ø¨Ø±Ú¯Ø´Øª</button>
                </div>`,
              )
              .join("") ||
            `<p class="text-center opacity-40 py-4 text-xs italic">${currentUser.isAdmin ? "ØªÙ…Ø§Ù… Ú©Ù„ÛŒØ¯Ù‡Ø§ Ø¯Ø± Ø¯ÙØªØ± Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª." : "Ø´Ù…Ø§ ÙØ¹Ù„Ø§Ù‹ Ú©Ù„ÛŒØ¯ÛŒ ØªØ­ÙˆÛŒÙ„ Ù†Ú¯Ø±ÙØªÙ‡â€ŒØ§ÛŒØ¯."}</p>`;
        }

        // Û³. Ø¨Ø®Ø´ ØªØ§Ø±ÛŒØ®Ú†Ù‡
        const filteredHistory = currentUser.isAdmin
          ? visitHistory
          : visitHistory.filter((h) => h.consultantPhone === currentUser.phone);

        const historyContainer = document.getElementById("returnedKeyList");
        if (historyContainer) {
          historyContainer.innerHTML =
            filteredHistory
              .map(
                (h) => `
                <div class="bg-white dark:bg-slate-800/50 p-4 rounded-2xl border-r-4 border-slate-300 dark:border-slate-700 flex justify-between items-center shadow-sm">
                    <div class="text-right">
                        <p class="font-bold text-xs text-slate-700 dark:text-slate-300">ÙˆØ§Ø­Ø¯ ${h.code}</p>
                        <p class="text-[10px] opacity-60 mt-1">ğŸ‘¤ Ù…Ø´Ø§ÙˆØ±: ${h.consultant}</p>
                        ${currentUser.isAdmin ? `<a href="tel:${h.consultantPhone}" class="text-[10px] text-blue-600 font-bold decoration-dotted underline">ğŸ“ ${h.consultantPhone}</a>` : ""}
                        <p class="text-[10px] opacity-60">ğŸ‘¥ Ù…Ø´ØªØ±ÛŒ: ${h.customer}</p>
                    </div>
                    <div class="text-left bg-slate-100 dark:bg-slate-700/50 p-2 rounded-lg min-w-[70px]">
                        <div class="text-[8px] font-bold text-red-500 italic">Ø®Ø±ÙˆØ¬: ${h.outTime}</div>
                        <div class="text-[8px] font-bold text-green-600 italic">ÙˆØ±ÙˆØ¯: ${h.inTime}</div>
                    </div>
                </div>`,
              )
              .join("") ||
            '<p class="text-center opacity-30 py-4 text-xs italic font-bold">Ù…ÙˆØ±Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
        }

        // Û´. Ø¢Ù¾Ø¯ÛŒØª ØªÙ‚ÙˆÛŒÙ…
        const calendarContainer = document.getElementById("calendarList");
        if (calendarContainer) {
          calendarContainer.innerHTML =
            calendarEvents
              .map(
                (e) => `
                <div class="bg-white dark:bg-slate-800 p-4 rounded-2xl border-r-4 border-blue-500 shadow-sm mb-2">
                    <div class="flex justify-between items-start">
                        <div><p class="font-black text-sm">${e.title}</p><p class="text-[10px] opacity-50">${e.date} | ØªÙˆØ³Ø·: ${e.creator}</p></div>
                        <span class="text-[10px] bg-blue-100 dark:bg-blue-900 text-blue-600 px-2 py-1 rounded-full font-bold">${e.type}</span>
                    </div>
                </div>`,
              )
              .join("") ||
            '<p class="opacity-30 text-center">Ø±ÙˆÛŒØ¯Ø§Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡.</p>';
        }

        // Ûµ. Ù„ÛŒØ³Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªØ§ÛŒÛŒØ¯ (ÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ†)
        if (currentUser.isAdmin) {
          const pendingList = document.getElementById("pendingList");
          if (pendingList) {
            const pend = consultants.filter((c) => c.status === "pending");
            pendingList.innerHTML = pend
              .map(
                (c) => `
                <div class="flex justify-between items-center bg-white dark:bg-slate-800 p-2 rounded-xl mb-1">
                    <span class="text-xs font-bold">${c.name} ${c.family}</span>
                    <button onclick="approveConsultant('${c.phone}')" class="bg-green-600 text-white text-[8px] px-2 py-1 rounded-lg">ØªØ§ÛŒÛŒØ¯</button>
                </div>`,
              )
              .join("");
          }
        }
      }

      function approveConsultant(p) {
        const i = consultants.findIndex((c) => c.phone === p);
        consultants[i].status = "active";
        saveDB();
        updateUI();
      }
      function saveDB() {
        localStorage.setItem("nader_v4_db", JSON.stringify(consultants));
      }
      function triggerError(el) {
        el.classList.add("error-shake");
        setTimeout(() => el.classList.remove("error-shake"), 500);
      }
      function closePropModal() {
        document.getElementById("propModal").classList.add("hidden");
      }
      function closeVisitModal() {
        document.getElementById("visitModal").classList.add("hidden");
      }
      function toggleDarkMode() {
        document.documentElement.classList.toggle("dark");
      }
      function handleLogout() {
        location.reload();
      }
      function showTab(id, btn) {
        document
          .querySelectorAll(".tab-content")
          .forEach((t) => t.classList.remove("active"));
        document.getElementById(id).classList.add("active");
        document
          .querySelectorAll(".nav-item")
          .forEach((n) => n.classList.remove("nav-active"));
        btn.classList.add("nav-active");
      }

      function prepareEdit(index) {
        const p = properties[index];

        // ØªØºÛŒÛŒØ± Ø¹Ù†ÙˆØ§Ù† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´
        document.getElementById("modalTitle").innerText =
          "ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ù„Ú© " + p.code;

        // Ù¾Ø± Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ¹Ù„ÛŒ
        document.getElementById("pCode").value = p.code;
        document.getElementById("pTitle").value = p.title;
        document.getElementById("pPrice").value = p.price;

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¹Ú©Ø³â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
        currentImgList = [...p.imgs];
        renderPreview(); // ØªØ§Ø¨Ø¹ÛŒ Ú©Ù‡ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø¹Ú©Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯

        // Ø°Ø®ÛŒØ±Ù‡ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø¯Ø± ÛŒÚ© Ù…ØªØºÛŒØ± Ø³Ø±Ø§Ø³Ø±ÛŒ ÛŒØ§ ÙÛŒÙ„Ø¯ Ù…Ø®ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ø²Ù…Ø§Ù† Ø°Ø®ÛŒØ±Ù‡
        window.editingIndex = index;

        // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„
        document.getElementById("propModal").classList.remove("hidden");

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÛŒÙ† Ø®Ø· Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ù‚Ø¨Ù„ÛŒ Ù‡Ù†Ú¯Ø§Ù… ÙˆÛŒØ±Ø§ÛŒØ´
        document.getElementById("pStatus").value =
          p.status || "empty_key_office";
      }

      function updateDots(propIdx) {
        const slider = document.getElementById(`slider-${propIdx}`);
        const scrollLeft = Math.abs(slider.scrollLeft); // Ù…Ù‚Ø¯Ø§Ø± Ø§Ø³Ú©Ø±ÙˆÙ„ Ø´Ø¯Ù‡
        const width = slider.offsetWidth; // Ø¹Ø±Ø¶ Ù‡Ø± Ø¹Ú©Ø³
        const activeIndex = Math.round(scrollLeft / width); // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø¯Ø§Ù… Ø¹Ú©Ø³ Ø±ÙˆØ¨Ø±ÙˆØ³Øª

        // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ù†Ù‚Ø·Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ù…Ù„Ú© Ùˆ Ø¢Ù¾Ø¯ÛŒØª Ú©Ø±Ø¯Ù†Ø´Ø§Ù†
        const dots = document.querySelectorAll(`[id^="dot-${propIdx}-"]`);
        dots.forEach((dot, i) => {
          if (i === activeIndex) {
            dot.classList.add("bg-white", "w-4"); // Ù†Ù‚Ø·Ù‡ ÙØ¹Ø§Ù„: Ø³ÙÛŒØ¯ Ùˆ Ú©Ø´ÛŒØ¯Ù‡
            dot.classList.remove("bg-white/40");
          } else {
            dot.classList.remove("bg-white", "w-4"); // Ù†Ù‚Ø·Ù‡ ØºÛŒØ±ÙØ¹Ø§Ù„: Ú©Ø¯Ø± Ùˆ Ú©ÙˆÚ†Ú©
            dot.classList.add("bg-white/40");
          }
        });
      }

      function removeImage(index) {
        // Ø­Ø°Ù Ø¹Ú©Ø³ Ø§Ø² Ù„ÛŒØ³Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø¢Ù†
        currentImgList.splice(index, 1);
        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø¯Ø± Ù…ÙˆØ¯Ø§Ù„
        renderPreview();
      }

      function getStatusStyle(status) {
        switch (status) {
          case "empty_key_office":
            return {
              text: "ğŸ—ï¸ Ø®Ø§Ù„ÛŒ - Ú©Ù„ÛŒØ¯ Ù†Ø²Ø¯ Ù…Ø§",
              class: "bg-green-100 text-green-600 dark:bg-green-900/30",
            };
          case "empty_key_owner":
            return {
              text: "ğŸ  Ø®Ø§Ù„ÛŒ - Ú©Ù„ÛŒØ¯ Ø¯Ø³Øª Ù…Ø§Ù„Ú©",
              class: "bg-blue-100 text-blue-600 dark:bg-blue-900/30",
            };
          case "owner_occupied":
            return {
              text: "ğŸ‘¤  Ù…Ø§Ù„Ú© Ø³Ø§Ú©Ù† Ø§Ø³Øª",
              class: "bg-orange-100 text-orange-600 dark:bg-orange-900/30",
            };
          case "tenant_occupied":
            return {
              text: "ğŸ‘¥ Ù…Ø³ØªØ£Ø¬Ø± Ø³Ø§Ú©Ù† Ø§Ø³Øª",
              class: "bg-red-100 text-red-600 dark:bg-red-900/30",
            };
          default:
            return { text: "Ù†Ø§Ù…Ø´Ø®Øµ", class: "bg-slate-100 text-slate-500" };
        }
      }

      function showAccessModal() {
        const modal = document.getElementById("accessDeniedModal");
        const content = document.getElementById("accessDeniedContent");
        modal.classList.remove("hidden");
        setTimeout(() => {
          content.classList.remove("scale-90");
          content.classList.add("scale-100");
        }, 10);
      }

      function closeAccessModal() {
        const modal = document.getElementById("accessDeniedModal");
        const content = document.getElementById("accessDeniedContent");
        content.classList.add("scale-90");
        content.classList.remove("scale-100");
        setTimeout(() => {
          modal.classList.add("hidden");
        }, 200);
      }

      function formatPrice(price) {
        if (!price || price === "ØªÙˆØ§ÙÙ‚ÛŒ") return "ØªÙˆØ§ÙÙ‚ÛŒ";

        // Ø­Ø°Ù Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ø­Ø±ÙˆÙ ÛŒØ§ Ú©Ø§Ù…Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
        const numericPrice = price.toString().replace(/[^0-9]/g, "");

        if (numericPrice === "") return "ØªÙˆØ§ÙÙ‚ÛŒ";

        // Ø¬Ø¯Ø§ Ú©Ø±Ø¯Ù† Ø³Ù‡ Ø±Ù‚Ù… Ø³Ù‡ Ø±Ù‚Ù…
        return parseInt(numericPrice).toLocaleString("fa-IR") + " ØªÙˆÙ…Ø§Ù†";
      } // Ø§ÛŒÙ†Ø¬Ø§ ØªØ§Ø¨Ø¹ ØªÙ…Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯


      // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø±Ø§ÛŒ ÙˆØ§Ø­Ø¯Ù‡Ø§ÛŒ Ø³Ø§Ú©Ù†â€ŒØ¯Ø§Ø±
      function openCoordinationModal(code) {
    activeCode = code; // Ú©Ø¯ Ù…Ù„Ú© Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    
    // Ù¾Ø± Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù…Ø´Ø§ÙˆØ±ÛŒÙ† Ø¯Ø± Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ù…ÙˆØ¬ÙˆØ¯
    document.getElementById("visitConsultantSelect").innerHTML =
        consultants
          .filter((c) => c.status === "active")
          .map((c) => `<option>${c.name} ${c.family}</option>`)
          .join("");
          
    // ØªØºÛŒÛŒØ± Ø¹Ù†ÙˆØ§Ù† ÛŒØ§ Ø¯Ú©Ù…Ù‡ Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø¯Ø§Ù†Ø¯ Ø§ÛŒÙ† "Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ" Ø§Ø³Øª
    document.getElementById("visitModal").classList.remove("hidden");
    
    // ÛŒÚ© Ú©Ù„Ú© Ú©ÙˆÚ†Ú©: Ø¯Ú©Ù…Ù‡ ØªØ§ÛŒÛŒØ¯ Ù…ÙˆØ¯Ø§Ù„ Ø±Ø§ Ù…ÙˆÙ‚ØªØ§Ù‹ ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… Ú©Ù‡ ØªØ§Ø¨Ø¹ Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†Ø¯
    const confirmBtn = document.querySelector("#visitModal button[onclick='confirmVisit()']");
    confirmBtn.setAttribute("onclick", "saveCoordination()");
    confirmBtn.innerText = "Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ";
}

      // Ø°Ø®ÛŒØ±Ù‡ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡ (Ø¨Ø¯ÙˆÙ† Ø¯Ø±Ú¯ÛŒØ± Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ù†Ú¯Ù‡Ø¨Ø§Ù†ÛŒ)
      function saveCoordination() {
    const cust = document.getElementById("visitCustomerName");
    if (!cust.value) return triggerError(cust);

    const selectedConsultantName = document.getElementById("visitConsultantSelect").value;
    const consultantData = consultants.find((c) => `${c.name} ${c.family}` === selectedConsultantName);

    const historyItem = {
        code: activeCode,
        consultant: selectedConsultantName,
        consultantPhone: consultantData ? consultantData.phone : "",
        customer: cust.value,
        outTime: "Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ø´Ø¯Ù‡", // Ú†ÙˆÙ† Ø®Ø±ÙˆØ¬ Ú©Ù„ÛŒØ¯ Ù†Ø¯Ø§Ø´ØªÛŒÙ…
        inTime: new Date().toLocaleTimeString("fa-IR", {
            hour: "2-digit",
            minute: "2-digit",
        }),
    };

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡
    visitHistory.unshift(historyItem);
    localStorage.setItem("nader_visit_history", JSON.stringify(visitHistory));

    // Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ú©Ù…Ù‡ Ù…ÙˆØ¯Ø§Ù„ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø¹Ø¯ÛŒ
    const confirmBtn = document.querySelector("#visitModal button[onclick='saveCoordination()']");
    confirmBtn.setAttribute("onclick", "confirmVisit()");
    confirmBtn.innerText = "ØªØ£ÛŒÛŒØ¯ Ø®Ø±ÙˆØ¬ Ú©Ù„ÛŒØ¯";

    closeVisitModal();
    updateUI();
    
    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯ Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯ÙØ¹Ù‡ Ø¨Ø¹Ø¯
    cust.value = "";
}
      // --- Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ (Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¨Ø§ÛŒØ¯ Ú©Ø§Ù…Ù„Ø§Ù‹ Ù…Ø³ØªÙ‚Ù„ Ø¨Ø§Ø´Ø¯) ---
      document.addEventListener("DOMContentLoaded", function () {
        const priceInput = document.getElementById("pPrice");
        if (priceInput) {
          priceInput.addEventListener("input", function (e) {
            let value = e.target.value.replace(/[^0-9]/g, "");
            if (value) {
              e.target.value = parseInt(value).toLocaleString();
            }
          });
        }
      });



    </script>

    <div
      id="errorModal"
      class="fixed inset-0 z-[1000] hidden bg-black/60 backdrop-blur-sm flex items-center justify-center p-6"
    >
      <div
        class="bg-white dark:bg-slate-900 w-full max-w-xs rounded-[2.5rem] p-8 text-center shadow-2xl border border-red-100 dark:border-red-900/30 scale-90 transition-transform duration-300"
        id="errorModalContent"
      >
        <div
          class="w-20 h-20 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto mb-6"
        >
          <span class="text-4xl">ğŸš«</span>
        </div>
        <h3 class="text-xl font-black text-slate-800 dark:text-white mb-2">
          Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯!
        </h3>
        <p
          class="text-sm text-slate-500 dark:text-slate-400 mb-8 leading-relaxed"
        >
          Ø´Ù…Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø§Ø¨ØªØ¯Ø§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ø§ Ù…Ø¯ÛŒØ±ÛŒØª
          ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.
        </p>
        <button
          onclick="closeErrorModal()"
          class="w-full bg-slate-900 dark:bg-red-600 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-transform"
        >
          Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…
        </button>
      </div>
    </div>

    <div
      id="confirmReturnModal"
      class="fixed inset-0 z-[1000] hidden bg-black/60 backdrop-blur-sm flex items-center justify-center p-6"
    >
      <div
        class="bg-white dark:bg-slate-900 w-full max-w-xs rounded-[2.5rem] p-8 text-center shadow-2xl border border-green-100 dark:border-green-900/30 scale-90 transition-transform duration-300"
        id="confirmReturnContent"
      >
        <div
          class="w-20 h-20 bg-green-100 dark:bg-green-900/20 rounded-full flex items-center justify-center mx-auto mb-6"
        >
          <span class="text-4xl">ğŸ”‘</span>
        </div>
        <h3 class="text-xl font-black text-slate-800 dark:text-white mb-2">
          Ø¨Ø§Ø²Ú¯Ø´Øª Ú©Ù„ÛŒØ¯
        </h3>
        <p
          id="returnModalText"
          class="text-sm text-slate-500 dark:text-slate-400 mb-8 leading-relaxed"
        >
          Ø¢ÛŒØ§ Ø¨Ø§Ø²Ú¯Ø´Øª Ú©Ù„ÛŒØ¯ ÙˆØ§Ø­Ø¯ Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŸ
        </p>
        <div class="flex gap-3">
          <button
            onclick="executeReturn()"
            class="flex-1 bg-green-600 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-transform"
          >
            ØªØ£ÛŒÛŒØ¯
          </button>
          <button
            onclick="closeReturnModal()"
            class="flex-1 bg-slate-100 dark:bg-slate-800 text-slate-500 py-4 rounded-2xl font-black active:scale-95 transition-transform"
          >
            Ù„ØºÙˆ
          </button>
        </div>
      </div>
    </div>

    <div
      id="accessDeniedModal"
      class="fixed inset-0 z-[1100] hidden bg-black/60 backdrop-blur-md flex items-center justify-center p-6"
    >
      <div
        class="bg-white dark:bg-slate-900 w-full max-w-xs rounded-[2.5rem] p-8 text-center shadow-2xl border border-red-100 dark:border-red-900/30 transition-all duration-300 scale-90"
        id="accessDeniedContent"
      >
        <div
          class="w-20 h-20 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto mb-6"
        >
          <span class="text-4xl">ğŸš«</span>
        </div>
        <h3 class="text-xl font-black text-slate-800 dark:text-white mb-2">
          Ø¹Ø¯Ù… Ø¯Ø³ØªØ±Ø³ÛŒ
        </h3>
        <p
          class="text-sm text-slate-500 dark:text-slate-400 mb-8 leading-relaxed"
        >
          Ù†Ø§Ø¯Ø± Ø¹Ø²ÛŒØ² (Ù…Ø¯ÛŒØ±ÛŒØª)ØŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø«Ø¨Øª Ù…Ù„Ú© Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§ÙˆØ±ÛŒÙ† ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª.
          Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ù…Ù„Ú© Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ú©Ù†ÛŒØ¯.
        </p>
        <button
          onclick="closeAccessModal()"
          class="w-full bg-slate-900 dark:bg-red-600 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-transform"
        >
          Ù…ØªÙˆØ¬Ù‡ Ø´Ø¯Ù…
        </button>
      </div>
    </div>
  </body>
</html>
